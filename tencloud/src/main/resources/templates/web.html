<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>test</title>
    <script type="text/javascript" src="https://qiniu.taeyeonss.com/cos-js-sdk-v5.min.js"></script>
    <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
    <script>
        var HOST = "http://localhost:7100";
        var DOMAIN = "https://xxx.com";
        var SECRET_ID = "";
        var SECRET_KEY = "";
        var BUCKET_NAME = "";
        var REGION = "ap-nanjing";
    </script>
</head>
<body>
<input type="button" onclick="queryList()" value="文件列表">
<br/><br/>
<input type="file" name="text" id="uploadFile">
<br/><br/>
<input type="button" value="上传" onclick="uploadCos()">
<script type="text/javascript">
    //实例化COS对象
    var cos = new COS({
        SecretId: SECRET_ID, //密钥id
        SecretKey: SECRET_KEY//密钥的key
    });

    //点击上传按钮上传文件到腾讯云
    function uploadCos() {
        var file = document.getElementById("uploadFile").files[0];
        var size = file.size;
        var fileName = file.name;
        var fileType = fileName.substring(fileName.lastIndexOf("\.") + 1);
        var newName = new Date().getTime() + '-' + getUuid() + '.' + fileType;
        var boo = false;
        var postData = {
            'fileName': newName,
            'originFileName': fileName,
            'url': DOMAIN + '/' + newName,
            'size': size
        };
        cos.putObject({
                Bucket: BUCKET_NAME, // 桶名-APPID  必须
                Region: REGION, //区域 必须
                Key: newName, //文件名必须
                StorageClass: 'STANDARD',
                Body: file, // 上传文件对象
                onTaskStart: function (progressData) {
                    console.log(JSON.stringify(progressData));//上传成功的返回值
                    boo = true;
                }
            },
            function (err, data) {
                console.log(err || data);//上传失败的返回值
                if (data.statusCode === 200 && boo) {
                    $.ajax({
                        url: HOST + "/insertToDB",
                        type: "post",
                        data: JSON.stringify(postData),
                        contentType: "application/json",
                        success: function (res) {
                            console.log(res);
                            alert(res);
                        },
                    })
                }
            }
        )
    }

    function getUuid() {
        function S4() {
            return (((1 + Math.random()) * 0x10000) | 0).toString(16).substring(1);
        }

        return (S4() + S4() + S4() + S4() + S4() + S4() + S4() + S4());
    }


    function queryList() {
        window.location.href = HOST + '/list?page=0&size=20';
    }
</script>
</body>
</html>